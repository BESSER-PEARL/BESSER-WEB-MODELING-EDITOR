Backend Integration
===================

The backend needs to know how to process the JSON model generated by your new diagram.
The backend services live in the BESSER repository under
``besser/utilities/web_modeling_editor/backend``. If you are working in the WME repo, clone BESSER alongside it and make
the backend changes there.
For the full backend + metamodel workflow, see the BESSER guide:
`Add a New DSL <https://besser.readthedocs.io/en/latest/contributing/create_dsl.html>`_.

1. Create a Processor
---------------------

Create ``besser/utilities/web_modeling_editor/backend/services/converters/json_to_buml/my_new_diagram_processor.py`` in
the BESSER repository.

.. code-block:: python

    from besser.BUML.metamodel.structural import DomainModel, Class
    # Import other BUML metamodel classes as needed

    def process_my_new_diagram(json_data: dict) -> DomainModel:
        """
        Converts MyNewDiagram JSON to a BUML model.
        """
        model = DomainModel(name=json_data.get("name", "MyModel"))
        
        elements = json_data.get("model", {}).get("elements", [])
        
        for element in elements:
            if element["type"] == "MyNewElement":
                # Map JSON properties to BUML objects
                new_class = Class(name=element["name"], parent=model)
                
        return model

2. Register the Processor
-------------------------

*   **Export**: Add to ``besser/utilities/web_modeling_editor/backend/services/converters/__init__.py``.
    
    .. code-block:: python
    
        from .json_to_buml.my_new_diagram_processor import process_my_new_diagram

*   **API Endpoint**: Update ``besser/utilities/web_modeling_editor/backend/backend.py``.
    
    Find the ``generate_code_output`` function (or the relevant handler) and add a case for your diagram type:

    .. code-block:: python

        if input_data.generator == "my-generator-type":
             # Or check input_data.diagram_type if available
             buml_model = process_my_new_diagram(json_data)
             # ... pass to generator

3. Keep conversions and validation in sync
------------------------------------------

* If the diagram can be imported back into the editor, also update the BUML -> JSON converters under
  ``besser/utilities/web_modeling_editor/backend/services/converters/buml_to_json``.
* Update validators under ``besser/utilities/web_modeling_editor/backend/services/validators`` so the new elements are
  checked consistently.
* Align JSON element and relationship type names with the editor package definitions to avoid mismatches.
