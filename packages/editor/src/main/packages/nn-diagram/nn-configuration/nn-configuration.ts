import { NNElementType, NNRelationshipType } from '..';
import { UMLElementType } from '../../uml-element-type';
import { IUMLElement } from '../../../services/uml-element/uml-element';
import { DeepPartial } from 'redux';
import { NNBaseLayer } from '../nn-base-layer';
import { NNElementRegistry } from '../nn-element-registry';

export class Configuration extends NNBaseLayer {
  type: UMLElementType = NNElementType.Configuration;
  name: string = 'Configuration';

  constructor(values?: DeepPartial<Configuration>) {
    super(values);

    // Register this Configuration so NNNext can prevent connections to it
    NNElementRegistry.registerConfiguration(this.id);

    if (!values?.bounds) {
      this.bounds = { x: 0, y: 0, width: 0, height: 0 };
    }
    if (!values?.name) {
      this.name = 'Configuration';
    }
    if (values?.ownedElements) {
      this.ownedElements = values.ownedElements.filter((id): id is string => id !== undefined);
    }
  }

  static supportedRelationships = [
    NNRelationshipType.NNComposition as any,
  ];

  reorderChildren(children: IUMLElement[]): string[] {
    // Preserve all children as-is, no reordering
    return children.filter(child => child && child.id).map(child => child.id);
  }
}
